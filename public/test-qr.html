<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test QR Code Scanner - C√¥te d'Ivoire Audio Guide</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 30px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
    }

    h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5em;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .instructions {
      background: #f0f4ff;
      border-left: 4px solid #667eea;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 40px;
    }

    .instructions h2 {
      color: #667eea;
      margin-bottom: 15px;
    }

    .instructions ol {
      margin-left: 20px;
      line-height: 1.8;
      color: #555;
    }

    .instructions li {
      margin-bottom: 10px;
    }

    .qr-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      margin-top: 30px;
    }

    .qr-container {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .qr-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
      border-color: #667eea;
    }

    .qr-container h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .qr-code {
      width: 300px;
      height: 300px;
      margin: 20px auto;
      border: 3px solid #667eea;
      border-radius: 10px;
      padding: 10px;
      background: white;
    }

    .qr-code.loading {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-style: italic;
    }

    .qr-info {
      margin: 15px 0;
      color: #666;
      font-size: 0.9em;
      line-height: 1.5;
    }

    .qr-info .lang-badge {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
      margin: 5px;
    }

    .qr-info .lang-badge.en {
      background: #764ba2;
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 500;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: #764ba2;
    }

    button.secondary:hover {
      background: #5f3a82;
    }

    .print-btn {
      background: #4caf50;
      margin-top: 30px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      padding: 15px 40px;
      font-size: 1.1em;
    }

    .print-btn:hover {
      background: #45a049;
    }

    .status {
      text-align: center;
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      font-weight: 500;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status.loading {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    @media print {
      body {
        background: white;
        padding: 0;
      }

      .container {
        box-shadow: none;
        padding: 20px;
      }

      .instructions, .print-btn, button {
        display: none;
      }

      .qr-container {
        page-break-inside: avoid;
        border: 2px solid #000;
      }
    }

    @media (max-width: 768px) {
      .qr-grid {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 2em;
      }

      .qr-code {
        width: 250px;
        height: 250px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéµ Test QR Code Scanner</h1>
    <p class="subtitle">C√¥te d'Ivoire Audio Guide - Mode Test</p>

    <div class="instructions">
      <h2>üì± Instructions d'utilisation</h2>
      <ol>
        <li><strong>Ouvrez l'application mobile</strong> C√¥te d'Ivoire Audio Guide sur votre appareil Android/iOS</li>
        <li><strong>Appuyez sur le bouton QR scanner</strong> (ic√¥ne violette en bas √† droite)</li>
        <li><strong>Accordez les permissions cam√©ra</strong> si demand√©</li>
        <li><strong>Scannez l'un des QR codes</strong> ci-dessous (affichez cette page sur un √©cran ou imprimez-la)</li>
        <li><strong>V√©rifiez le comportement</strong> : navigation automatique vers l'attraction + lecture audio automatique</li>
      </ol>
      
      <p style="margin-top: 15px; color: #667eea; font-weight: 500;">
        üí° Astuce : Pour tester en production, utilisez l'URL du backend d√©ploy√© (Render.com) au lieu de localhost.
      </p>
    </div>

    <div id="status" class="status loading">
      üîÑ G√©n√©ration des QR codes en cours...
    </div>

    <div class="qr-grid" id="qrGrid">
      <!-- QR codes will be inserted here dynamically -->
    </div>

    <button class="print-btn" onclick="window.print()">
      üñ®Ô∏è Imprimer les QR Codes
    </button>
  </div>

  <script>
    // Configuration
    const API_URL = 'http://localhost:5000'; // Changez pour production: https://your-backend.onrender.com
    
    // Attractions de test (IDs MongoDB r√©els)
    const testAttractions = [
      {
        id: '68ebc2e68ac7906eba6138ce', // Remplacez par un vrai ID de votre DB
        name: 'Basilique Notre-Dame de la Paix',
        location: 'Yamoussoukro',
        languages: ['fr', 'en']
      },
      {
        id: '68ebc2e68ac7906eba6138cf', // Remplacez par un autre ID
        name: 'Mus√©e des Civilisations',
        location: 'Abidjan',
        languages: ['fr', 'en']
      }
    ];

    // Fonction principale pour g√©n√©rer tous les QR codes
    async function generateAllQRCodes() {
      const statusEl = document.getElementById('status');
      const gridEl = document.getElementById('qrGrid');

      try {
        statusEl.className = 'status loading';
        statusEl.textContent = 'üîÑ G√©n√©ration des QR codes en cours...';

        gridEl.innerHTML = ''; // Clear grid

        // G√©n√©rer QR codes pour chaque attraction et langue
        for (const attraction of testAttractions) {
          for (const lang of attraction.languages) {
            await generateQRCode(attraction, lang);
          }
        }

        statusEl.className = 'status success';
        statusEl.innerHTML = `‚úÖ ${testAttractions.length * 2} QR codes g√©n√©r√©s avec succ√®s !<br><small>Pr√™t pour le test mobile</small>`;

      } catch (error) {
        console.error('Erreur g√©n√©ration QR codes:', error);
        statusEl.className = 'status error';
        statusEl.innerHTML = `‚ùå Erreur: ${error.message}<br><small>V√©rifiez que le backend est d√©marr√© sur ${API_URL}</small>`;
      }
    }

    // G√©n√©rer un QR code individuel
    async function generateQRCode(attraction, lang) {
      const gridEl = document.getElementById('qrGrid');

      // Cr√©er le conteneur
      const container = document.createElement('div');
      container.className = 'qr-container';
      container.id = `qr-${attraction.id}-${lang}`;

      // Titre
      const title = document.createElement('h3');
      title.textContent = `${attraction.name}`;
      container.appendChild(title);

      // Info langue et localisation
      const info = document.createElement('div');
      info.className = 'qr-info';
      info.innerHTML = `
        <span class="lang-badge ${lang}">${lang === 'fr' ? 'üá´üá∑ Fran√ßais' : 'üá¨üáß English'}</span>
        <br>
        <small>üìç ${attraction.location}</small>
      `;
      container.appendChild(info);

      // Image QR (placeholder)
      const qrImg = document.createElement('img');
      qrImg.className = 'qr-code loading';
      qrImg.alt = `QR Code ${attraction.name} (${lang})`;
      qrImg.textContent = '‚è≥ Chargement...';
      container.appendChild(qrImg);

      // Boutons d'action
      const actions = document.createElement('div');
      actions.className = 'actions';
      actions.innerHTML = `
        <button onclick="downloadQR('${attraction.id}', '${lang}', '${attraction.name}')">
          üíæ T√©l√©charger PNG
        </button>
        <button class="secondary" onclick="copyQRContent('${attraction.id}', '${lang}')">
          üìã Copier URL
        </button>
      `;
      container.appendChild(actions);

      gridEl.appendChild(container);

      // Appel API pour g√©n√©rer le QR code
      try {
        const response = await fetch(
          `${API_URL}/api/qr/generate/${attraction.id}?format=dataURL&size=300&preferredLang=${lang}`
        );

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();

        if (data.success && data.data.qrCode) {
          qrImg.src = data.data.qrCode;
          qrImg.className = 'qr-code'; // Remove loading state
          qrImg.dataset.qrContent = data.data.qrContent; // Store for copying
        } else {
          throw new Error('Format de r√©ponse invalide');
        }

      } catch (error) {
        console.error(`Erreur g√©n√©ration QR ${attraction.name} (${lang}):`, error);
        qrImg.className = 'qr-code';
        qrImg.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300"><rect fill="%23f8d7da" width="300" height="300"/><text x="150" y="150" text-anchor="middle" fill="%23721c24" font-size="16">‚ùå Erreur</text></svg>';
      }
    }

    // T√©l√©charger un QR code en PNG
    async function downloadQR(attractionId, lang, attractionName) {
      const imgEl = document.querySelector(`#qr-${attractionId}-${lang} .qr-code`);
      
      if (!imgEl || !imgEl.src.startsWith('data:')) {
        alert('QR code non disponible pour t√©l√©chargement');
        return;
      }

      // Cr√©er un lien de t√©l√©chargement
      const a = document.createElement('a');
      a.href = imgEl.src;
      a.download = `qr-${attractionName.replace(/\s+/g, '-').toLowerCase()}-${lang}.png`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      // Toast notification
      showToast(`‚úÖ QR code t√©l√©charg√© : ${attractionName} (${lang})`, 'success');
    }

    // Copier le contenu du QR code (deep link)
    function copyQRContent(attractionId, lang) {
      const imgEl = document.querySelector(`#qr-${attractionId}-${lang} .qr-code`);
      const qrContent = imgEl.dataset.qrContent;

      if (!qrContent) {
        alert('Contenu QR code non disponible');
        return;
      }

      // Copier dans le presse-papiers
      navigator.clipboard.writeText(qrContent).then(() => {
        showToast(`üìã URL copi√©e : ${qrContent}`, 'success');
      }).catch(err => {
        alert(`Erreur copie : ${err.message}`);
      });
    }

    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `status ${type}`;
      toast.style.position = 'fixed';
      toast.style.top = '20px';
      toast.style.left = '50%';
      toast.style.transform = 'translateX(-50%)';
      toast.style.zIndex = '9999';
      toast.style.minWidth = '300px';
      toast.textContent = message;
      
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.transition = 'opacity 0.5s ease';
        toast.style.opacity = '0';
        setTimeout(() => document.body.removeChild(toast), 500);
      }, 3000);
    }

    // Lancer la g√©n√©ration au chargement de la page
    window.onload = generateAllQRCodes;
  </script>
</body>
</html>
